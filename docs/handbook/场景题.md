# 场景题

## 1.一个32位系统，dump结果有1G，但是用户申请512M却触发OOM了，有几种原因？
<details>
<summary>答案</summary>
<p>1.内存被小的分配占用，导致没有足够大的连续空间分配给512M的请求</p>
<p>2.可能操作系统对单个进程可以使用的内存量有限制，即使系统内存足够，超出限制后也会出发OOM错误</p>
<p>3.可能有一部分内存是操作系统保留的内存，实际用户能使用的内存已经不足512M了</p>
<p>4.可能存在内存泄漏，即使系统报告有大量未使用的内存，但实际可用内存已经很少了</p>
</details>

## 2.如何保证幂等性
<details>
<summary>答案</summary>
<p>1.Token机制：客户端请求时，服务端发放一个Token，客户端提交请求时携带这个Token。服务器收到请求后，判断Token是否有效，有效则执行操作，并使Token失效，否则不执行任何操作。</p>
<p>2.悲观锁机制：在数据库中使用版本号或时间戳机制，尝试更新数据时检查版本号或时间戳，如果不匹配则不执行任何操作，否则执行操作并更新版本号或时间戳</p>
<p>3.使用唯一标识符：客户端为每个请求生成一个唯一标识符，服务端根据这个唯一标识符判断请求是否执行过，如果已经执行过不，则忽略，否则执行操作。</p>
</details>

## 3.一个外卖平台上有一个外卖单子，现在有多名骑手想接这一单，如何保证只有一个骑手可以接到单子？ 
<details>
<summary>答案</summary>
<p>骑手接单之前尝试以订单编号为key进行加锁，如果加锁成功则可以接到该单子，否则不可以</p>
</details>

## 4.10亿个数，找出最大的10个
<details>
<summary>答案</summary>
<p>堆/快速选择</p>
</details>


## 5.10亿个数排序
<details>
<summary>答案</summary>
<p>首先将数据进行分成n块，对每个块加载进内存进行排序，然后取出n个块中的第一个元素，放入堆中，然后弹出堆顶元素，然后根据弹出的元素去对应的块中取出一个元素放入，直到时堆被取空。</p>
<p>通过bitmap排序，将所有数字塞入bitmap,然后从小到大遍历一遍bitmap</p>
</details>

## 6.如何把一个文件较快的发送到100w个服务器？
<details>
<summary>答案</summary>
<p>首先将文件发送给1000个服务器，然后每一个服务器发送给另外1000个服务器</p>
</details>
